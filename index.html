<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rural Telemedicine Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .tab-active {
            border-bottom: 2px solid #3b82f6;
            color: #2563eb;
        }
        .tab-inactive {
            border-bottom: 2px solid transparent;
            color: #6b7280;
        }
        .tab-inactive:hover {
            color: #374151;
            border-color: #d1d5db;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 50;
        }
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .status-online {
            background-color: #dcfce7;
            color: #166534;
        }
        .status-offline {
            background-color: #fef2f2;
            color: #991b1b;
        }
        .severity-high {
            background-color: #fef2f2;
            color: #dc2626;
            border-color: #fecaca;
        }
        .severity-medium {
            background-color: #fffbeb;
            color: #d97706;
            border-color: #fed7aa;
        }
        .severity-low {
            background-color: #f0fdf4;
            color: #16a34a;
            border-color: #bbf7d0;
        }
        .listening-pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <h1 id="app-title" class="text-2xl font-bold text-gray-900">Rural Telemedicine Platform</h1>
                
                <div class="flex items-center gap-4">
                    <!-- Connection Status -->
                    <div id="connection-status" class="flex items-center px-3 py-1 rounded-full text-sm status-online">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0"></path>
                        </svg>
                        <span id="status-text">Online</span>
                    </div>

                    <!-- Language Selector -->
                    <select id="language-selector" class="border border-gray-300 rounded-lg px-3 py-1 text-sm">
                        <option value="en">English</option>
                        <option value="hi">हिंदी</option>
                        <option value="ta">தமிழ்</option>
                        <option value="te">తెలుగు</option>
                        <option value="kn">ಕನ್ನಡ</option>
                        <option value="ml">മലയാളം</option>
                        <option value="gu">ગુજરાતી</option>
                        <option value="mr">मराठी</option>
                        <option value="pa">ਪੰਜਾਬੀ</option>
                        <option value="bn">বাংলা</option>
                    </select>
                </div>
            </div>

            <!-- Navigation Tabs -->
            <div class="mt-4 border-b">
                <nav class="flex space-x-8 overflow-x-auto">
                    <button data-tab="patients" class="flex items-center px-1 py-2 font-medium text-sm whitespace-nowrap tab-active">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        <span data-i18n="patientRegistration">Patient Registration</span>
                    </button>
                    <button data-tab="records" class="flex items-center px-1 py-2 font-medium text-sm whitespace-nowrap tab-inactive">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <span data-i18n="digitalHealthRecords">Digital Health Records</span>
                    </button>
                    <button data-tab="symptoms" class="flex items-center px-1 py-2 font-medium text-sm whitespace-nowrap tab-inactive">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"></path>
                        </svg>
                        <span data-i18n="symptomChecker">Symptom Checker</span>
                    </button>
                    <button data-tab="pharmacy" class="flex items-center px-1 py-2 font-medium text-sm whitespace-nowrap tab-inactive">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        <span data-i18n="pharmacySearch">Pharmacy Search</span>
                    </button>
                    <button data-tab="consultation" class="flex items-center px-1 py-2 font-medium text-sm whitespace-nowrap tab-inactive">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                        </svg>
                        <span data-i18n="teleconsultation">Video Consultation</span>
                    </button>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 py-6">
        <!-- Patient Registration Tab -->
        <div id="patients-tab" class="tab-content">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center mb-4">
                    <svg class="w-6 h-6 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                    <h2 class="text-xl font-semibold text-gray-800" data-i18n="patientRegistration">Patient Registration</h2>
                </div>
                
                <form id="patient-form" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <input name="name" placeholder="Full Name *" required class="border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <input name="age" type="number" placeholder="Age *" required class="border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <input name="village" placeholder="Village/Location *" required class="border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <input name="phone" type="tel" placeholder="Phone Number" class="border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <select name="gender" class="border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                    </select>
                    <select name="bloodGroup" class="border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">Blood Group</option>
                        <option value="A+">A+</option>
                        <option value="A-">A-</option>
                        <option value="B+">B+</option>
                        <option value="B-">B-</option>
                        <option value="AB+">AB+</option>
                        <option value="AB-">AB-</option>
                        <option value="O+">O+</option>
                        <option value="O-">O-</option>
                    </select>
                    <input name="emergencyContact" type="tel" placeholder="Emergency Contact Number" class="border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </form>
                
                <textarea name="medicalHistory" placeholder="Medical History (optional)" rows="3" class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-4"></textarea>
                
                <div class="flex flex-wrap gap-2">
                    <button id="save-patient" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg">
                        <span data-i18n="save">Save Patient</span>
                    </button>
                    <span class="text-sm text-gray-600 flex items-center">
                        Total Patients: <span id="patient-count">0</span>
                    </span>
                </div>
            </div>
        </div>

        <!-- Health Records Tab -->
        <div id="records-tab" class="tab-content" style="display: none;">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        <svg class="w-6 h-6 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <h2 class="text-xl font-semibold text-gray-800" data-i18n="digitalHealthRecords">Digital Health Records</h2>
                    </div>
                    
                    <div class="flex gap-2">
                        <button id="add-record-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm">
                            <span data-i18n="addRecord">Add Health Record</span>
                        </button>
                        <button id="export-data-btn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm flex items-center">
                            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            <span data-i18n="exportData">Export Data</span>
                        </button>
                    </div>
                </div>

                <!-- Patient Selection -->
                <div class="mb-4">
                    <select id="patient-select" class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500">
                        <option value="">Select Patient</option>
                    </select>
                </div>

                <!-- Health Records List -->
                <div id="health-records-list" class="space-y-4 max-h-96 overflow-y-auto">
                    <p class="text-gray-500 text-center py-8">Select a patient to view health records</p>
                </div>
            </div>
        </div>

        <!-- Symptom Checker Tab -->
        <div id="symptoms-tab" class="tab-content" style="display: none;">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center mb-4">
                    <svg class="w-6 h-6 text-green-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"></path>
                    </svg>
                    <h2 class="text-xl font-semibold text-gray-800" data-i18n="symptomChecker">Symptom Checker</h2>
                </div>

                <textarea id="symptoms-input" placeholder="Describe your symptoms" rows="4" class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-green-500 focus:border-transparent mb-4"></textarea>

                <div class="flex flex-wrap gap-2 mb-4">
                    <button id="voice-input-btn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center">
                        <div id="voice-indicator" class="w-2 h-2 rounded-full mr-2"></div>
                        <span id="voice-text">Voice Input</span>
                    </button>
                    <button id="analyze-symptoms-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg">
                        <span data-i18n="check">Analyze Symptoms</span>
                    </button>
                </div>

                <div id="symptom-result" class="hidden p-4 rounded-lg border">
                    <p id="result-text" class="font-medium"></p>
                    <div id="emergency-call" class="mt-2 hidden">
                        <button class="bg-red-600 text-white px-4 py-2 rounded-lg flex items-center">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                            </svg>
                            Call Emergency: 108
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pharmacy Search Tab -->
        <div id="pharmacy-tab" class="tab-content" style="display: none;">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center mb-4">
                    <svg class="w-6 h-6 text-purple-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    <h2 class="text-xl font-semibold text-gray-800" data-i18n="pharmacySearch">Pharmacy Search</h2>
                </div>

                <div class="flex gap-2 mb-4">
                    <input id="medicine-search" placeholder="Medicine Name" class="flex-1 border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    <button id="search-medicine-btn" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg">
                        <span data-i18n="search">Search</span>
                    </button>
                </div>

                <div id="pharmacy-results" class="space-y-3"></div>
            </div>
        </div>

        <!-- Teleconsultation Tab -->
        <div id="consultation-tab" class="tab-content" style="display: none;">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center mb-4">
                    <svg class="w-6 h-6 text-indigo-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                    </svg>
                    <h2 class="text-xl font-semibold text-gray-800" data-i18n="teleconsultation">Video Consultation</h2>
                </div>

                <div id="consultation-setup">
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Select Consultation Type:
                        </label>
                        <select id="consultation-type" class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-indigo-500">
                            <option value="general">👨‍⚕️ General Consultation</option>
                            <option value="emergency">🚨 Emergency Consultation</option>
                            <option value="followup">📋 Follow-up Consultation</option>
                            <option value="specialist">🔬 Specialist Consultation</option>
                        </select>
                    </div>

                    <div class="text-center">
                        <div class="w-20 h-20 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-10 h-10 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                            </svg>
                        </div>
                        <p class="text-gray-600 mb-4">
                            Connect with healthcare professionals through secure video consultation
                        </p>
                        
                        <button id="start-consultation-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white px-8 py-3 rounded-lg text-lg font-medium">
                            Start General Consultation
                        </button>
                        
                        <div class="mt-4 p-4 bg-blue-50 rounded-lg">
                            <p class="text-sm text-blue-800">
                                <strong>Note:</strong> This is a demo interface. In production, this would integrate with 
                                video calling services with end-to-end encryption for patient privacy.
                            </p>
                        </div>
                    </div>
                </div>

                <div id="consultation-active" class="bg-gray-900 rounded-lg p-8 text-center text-white hidden">
                    <div class="mb-4">
                        <svg class="w-16 h-16 mx-auto mb-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                        </svg>
                        <h3 class="text-xl font-semibold mb-2">
                            <span id="consultation-icon">👨‍⚕️</span> Video Call Active
                        </h3>
                        <p class="text-gray-300">Room ID: <span id="room-id"></span></p>
                        <p class="text-sm text-gray-400 mt-1">
                            Type: <span id="consultation-type-display">General Consultation</span>
                        </p>
                    </div>
                    
                    <div class="flex justify-center gap-4 mt-6">
                        <button id="end-call-btn" class="bg-red-600 hover:bg-red-700 px-6 py-2 rounded-lg">
                            End Call
                        </button>
                        <button id="leave-call-btn" class="bg-gray-600 hover:bg-gray-700 px-6 py-2 rounded-lg">
                            Leave
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Emergency Contact - Always visible -->
        <div class="mt-6 bg-red-50 border border-red-200 rounded-lg p-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <svg class="w-5 h-5 text-red-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                    </svg>
                    <span class="font-semibold text-red-800" data-i18n="emergency">Emergency</span>
                    <span class="ml-2 text-red-700">: 108 (Ambulance) • 102 (Medical Emergency)</span>
                </div>
                <span id="offline-indicator" class="text-xs text-orange-600 bg-orange-100 px-2 py-1 rounded hidden">
                    Offline Mode - Data will sync when online
                </span>
            </div>
        </div>
    </main>

    <!-- Add Health Record Modal -->
    <div id="add-record-modal" class="modal">
        <div class="bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <h3 class="text-lg font-semibold mb-4" data-i18n="addRecord">Add Health Record</h3>
            
            <form id="health-record-form">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <input name="bloodPressure" placeholder="Blood Pressure (e.g., 120/80)" class="border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500">
                    <input name="temperature" type="number" placeholder="Temperature (°F)" class="border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500">
                    <input name="weight" type="number" placeholder="Weight (kg)" class="border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500">
                    <input name="height" type="number" placeholder="Height (cm)" class="border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500">
                </div>

                <div class="space-y-4">
                    <textarea name="symptoms" placeholder="Symptoms" rows="3" class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500"></textarea>
                    <input name="diagnosis" placeholder="Diagnosis" class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500">
                    <textarea name="treatment" placeholder="Treatment Plan" rows="2" class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500"></textarea>
                    <input name="medications" placeholder="Current Medications" class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500">
                    <input name="allergies" placeholder="Allergies" class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500">
                    <textarea name="notes" placeholder="Medical Notes" rows="3" class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500"></textarea>
                    <input name="followUpDate" type="date" placeholder="Follow-up Date" class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500">
                </div>
            </form>

            <div class="flex justify-end gap-2 mt-6">
                <button id="cancel-record-btn" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                    Cancel
                </button>
                <button id="save-record-btn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                    Save
                </button>
            </div>
        </div>
    </div>

    <script>
        // Global State Management
        const appState = {
            patients: JSON.parse(localStorage.getItem('patients') || '[]'),
            healthRecords: JSON.parse(localStorage.getItem('healthRecords') || '[]'),
            syncQueue: JSON.parse(localStorage.getItem('syncQueue') || '[]'),
            currentLanguage: 'en',
            isOnline: navigator.onLine,
            selectedPatientId: null
        };

        // Translation Service
        const translations = {
            en: {
                appTitle: "Rural Telemedicine Platform",
                patientRegistration: "Patient Registration",
                digitalHealthRecords: "Digital Health Records",
                symptomChecker: "Symptom Checker",
                pharmacySearch: "Pharmacy Search",
                teleconsultation: "Video Consultation",
                save: "Save Patient",
                search: "Search",
                check: "Analyze Symptoms",
                speak: "Voice Input",
                name: "Full Name",
                age: "Age",
                village: "Village/Location",
                medicine: "Medicine Name",
                symptoms: "Describe your symptoms",
                online: "Online",
                offline: "Offline",
                emergency: "Emergency Contact",
                viewRecords: "View Health Records",
                addRecord: "Add Health Record",
                exportData: "Export Patient Data",
                bloodPressure: "Blood Pressure",
                temperature: "Temperature",
                weight: "Weight",
                height: "Height",
                allergies: "Allergies",
                medications: "Current Medications",
                notes: "Medical Notes",
                diagnosis: "Diagnosis",
                treatment: "Treatment Plan",
                followUp: "Follow-up Date",
                vitals: "Vital Signs",
                history: "Medical History"
            },
            hi: {
                appTitle: "ग्रामीण टेलीमेडिसिन प्लेटफॉर्म",
                patientRegistration: "रोगी पंजीकरण",
                digitalHealthRecords: "डिजिटल स्वास्थ्य रिकॉर्ड",
                symptomChecker: "लक्षण जांचकर्ता",
                pharmacySearch: "दवाखाना खोज",
                teleconsultation: "वीडियो परामर्श",
                save: "रोगी सहेजें",
                search: "खोजें",
                check: "लक्षणों का विश्लेषण",
                speak: "आवाज इनपुट",
                name: "पूरा नाम",
                age: "आयु",
                village: "गांव/स्थान",
                medicine: "दवा का नाम",
                symptoms: "अपने लक्षणों का वर्णन करें",
                online: "ऑनलाइन",
                offline: "ऑफलाइन",
                emergency: "आपातकालीन संपर्क",
                addRecord: "स्वास्थ्य रिकॉर्ड जोड़ें",
                exportData: "रोगी डेटा निर्यात करें"
            },
            ta: {
                appTitle: "கிராமப்புற டெலிமெடிசின் தளம்",
                patientRegistration: "நோயாளி பதிவு",
                digitalHealthRecords: "டிஜிட்டல் சுகாதார பதிவுகள்",
                symptomChecker: "அறிகுறி சரிபார்ப்பு",
                pharmacySearch: "மருந்தகம் தேடல்",
                teleconsultation: "வீடியோ ஆலோசனை",
                save: "நோயாளியைச் சேமிக்கவும்",
                search: "தேடு",
                check: "அறிகுறிகளை பகுப்பாய்வு செய்",
                speak: "குரல் உள்ளீடு"
            }
        };

        // Database Operations
        const db = {
            save: (key, data) => {
                localStorage.setItem(key, JSON.stringify(data));
            },
            
            addPatient: (patientData) => {
                const id = 'PAT-' + Date.now();
                const patient = {
                    ...patientData,
                    id,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    version: 1
                };
                appState.patients.push(patient);
                db.save('patients', appState.patients);
                return id;
            },

            addHealthRecord: (recordData) => {
                const id = 'REC-' + Date.now();
                const record = {
                    ...recordData,
                    id,
                    createdAt: new Date().toISOString(),
                    syncStatus: 'pending'
                };
                appState.healthRecords.push(record);
                db.save('healthRecords', appState.healthRecords);
                return id;
            },

            getRecordsByPatient: (patientId) => {
                return appState.healthRecords.filter(r => r.patientId === patientId);
            },

            exportPatientData: (patientId) => {
                const patient = appState.patients.find(p => p.id === patientId);
                const records = db.getRecordsByPatient(patientId);
                return { patient, records };
            }
        };

        // Translation Function
        function t(key) {
            return translations[appState.currentLanguage]?.[key] || translations.en[key] || key;
        }

        // Update Translations
        function updateTranslations() {
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                el.textContent = t(key);
            });
            document.getElementById('app-title').textContent = t('appTitle');
        }

        // Tab Management
        function showTab(tabId) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('[data-tab]').forEach(btn => {
                btn.className = btn.className.replace('tab-active', 'tab-inactive');
            });
            
            // Show selected tab
            document.getElementById(tabId + '-tab').style.display = 'block';
            
            // Add active class to selected tab button
            document.querySelector(`[data-tab="${tabId}"]`).className = 
                document.querySelector(`[data-tab="${tabId}"]`).className.replace('tab-inactive', 'tab-active');
        }

        // Patient Registration
        function initPatientRegistration() {
            const form = document.getElementById('patient-form');
            const saveBtn = document.getElementById('save-patient');
            const medicalHistoryTextarea = document.querySelector('textarea[name="medicalHistory"]');

            saveBtn.addEventListener('click', () => {
                const formData = new FormData(form);
                const patientData = Object.fromEntries(formData);
                patientData.medicalHistory = medicalHistoryTextarea.value;

                if (!patientData.name || !patientData.age || !patientData.village) {
                    alert('Please fill all required fields');
                    return;
                }

                try {
                    db.addPatient(patientData);
                    alert('Patient data saved successfully!');
                    form.reset();
                    medicalHistoryTextarea.value = '';
                    updatePatientCount();
                    updatePatientSelect();
                } catch (error) {
                    console.error('Save error:', error);
                    alert('Error saving patient data');
                }
            });

            updatePatientCount();
        }

        function updatePatientCount() {
            document.getElementById('patient-count').textContent = appState.patients.length;
        }

        function updatePatientSelect() {
            const select = document.getElementById('patient-select');
            select.innerHTML = '<option value="">Select Patient</option>';
            
            appState.patients.forEach(patient => {
                const option = document.createElement('option');
                option.value = patient.id;
                option.textContent = `${patient.name} - ${patient.village} (Age: ${patient.age})`;
                select.appendChild(option);
            });
        }

        // Health Records Management
        function initHealthRecords() {
            const patientSelect = document.getElementById('patient-select');
            const addRecordBtn = document.getElementById('add-record-btn');
            const exportBtn = document.getElementById('export-data-btn');
            const modal = document.getElementById('add-record-modal');
            const cancelBtn = document.getElementById('cancel-record-btn');
            const saveRecordBtn = document.getElementById('save-record-btn');
            const healthRecordForm = document.getElementById('health-record-form');

            patientSelect.addEventListener('change', (e) => {
                appState.selectedPatientId = e.target.value;
                loadHealthRecords();
            });

            addRecordBtn.addEventListener('click', () => {
                if (!appState.selectedPatientId) {
                    alert('Please select a patient first');
                    return;
                }
                modal.classList.add('active');
            });

            cancelBtn.addEventListener('click', () => {
                modal.classList.remove('active');
                healthRecordForm.reset();
            });

            saveRecordBtn.addEventListener('click', () => {
                if (!appState.selectedPatientId) {
                    alert('Please select a patient first');
                    return;
                }

                const formData = new FormData(healthRecordForm);
                const recordData = Object.fromEntries(formData);
                recordData.patientId = appState.selectedPatientId;
                recordData.type = 'health_record';

                try {
                    db.addHealthRecord(recordData);
                    alert('Health record saved successfully!');
                    modal.classList.remove('active');
                    healthRecordForm.reset();
                    loadHealthRecords();
                } catch (error) {
                    console.error('Error saving record:', error);
                    alert('Error saving health record');
                }
            });

            exportBtn.addEventListener('click', () => {
                if (!appState.selectedPatientId) {
                    alert('Please select a patient first');
                    return;
                }

                try {
                    const data = db.exportPatientData(appState.selectedPatientId);
                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `patient-${appState.selectedPatientId}-health-records.json`;
                    a.click();
                    URL.revokeObjectURL(url);
                } catch (error) {
                    console.error('Export failed:', error);
                    alert('Export failed');
                }
            });

            updatePatientSelect();
        }

        function loadHealthRecords() {
            const recordsList = document.getElementById('health-records-list');
            
            if (!appState.selectedPatientId) {
                recordsList.innerHTML = '<p class="text-gray-500 text-center py-8">Select a patient to view health records</p>';
                return;
            }

            const records = db.getRecordsByPatient(appState.selectedPatientId);
            
            if (records.length === 0) {
                recordsList.innerHTML = '<p class="text-gray-500 text-center py-8">No health records found for this patient</p>';
                return;
            }

            recordsList.innerHTML = records.map(record => `
                <div class="border border-gray-200 rounded-lg p-4">
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            <span class="font-medium text-gray-800">
                                ${record.type.charAt(0).toUpperCase() + record.type.slice(1)} Record
                            </span>
                        </div>
                        <span class="text-sm text-gray-500">
                            ${new Date(record.createdAt).toLocaleDateString()}
                        </span>
                    </div>

                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4 text-sm">
                        ${record.bloodPressure ? `<div><span class="font-medium">Blood Pressure:</span> ${record.bloodPressure}</div>` : ''}
                        ${record.temperature ? `<div><span class="font-medium">Temperature:</span> ${record.temperature}°F</div>` : ''}
                        ${record.weight ? `<div><span class="font-medium">Weight:</span> ${record.weight} kg</div>` : ''}
                        ${record.diagnosis ? `<div class="col-span-2 md:col-span-3"><span class="font-medium">Diagnosis:</span> ${record.diagnosis}</div>` : ''}
                        ${record.treatment ? `<div class="col-span-2 md:col-span-3"><span class="font-medium">Treatment:</span> ${record.treatment}</div>` : ''}
                        ${record.notes ? `<div class="col-span-2 md:col-span-3"><span class="font-medium">Notes:</span> ${record.notes}</div>` : ''}
                    </div>
                </div>
            `).join('');
        }

        // Symptom Checker
        function initSymptomChecker() {
            const symptomsInput = document.getElementById('symptoms-input');
            const voiceBtn = document.getElementById('voice-input-btn');
            const analyzeBtn = document.getElementById('analyze-symptoms-btn');
            const resultDiv = document.getElementById('symptom-result');
            const resultText = document.getElementById('result-text');
            const emergencyCall = document.getElementById('emergency-call');
            const voiceIndicator = document.getElementById('voice-indicator');
            const voiceText = document.getElementById('voice-text');

            let isListening = false;

            voiceBtn.addEventListener('click', () => {
                if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                    alert('Speech recognition not supported in this browser');
                    return;
                }

                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                const recognition = new SpeechRecognition();
                
                const langMap = {
                    'en': 'en-US', 'hi': 'hi-IN', 'ta': 'ta-IN', 'te': 'te-IN',
                    'kn': 'kn-IN', 'ml': 'ml-IN', 'gu': 'gu-IN', 'mr': 'mr-IN',
                    'pa': 'pa-IN', 'bn': 'bn-IN'
                };
                
                recognition.lang = langMap[appState.currentLanguage] || 'en-US';
                recognition.continuous = false;
                recognition.interimResults = false;

                isListening = true;
                voiceIndicator.className = 'w-2 h-2 rounded-full mr-2 bg-white listening-pulse';
                voiceText.textContent = 'Listening...';
                voiceBtn.className = voiceBtn.className.replace('bg-green-600', 'bg-red-500');

                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    symptomsInput.value += ' ' + transcript;
                    stopListening();
                };

                recognition.onerror = (err) => {
                    console.error('Speech error:', err);
                    stopListening();
                };

                recognition.onend = () => {
                    stopListening();
                };

                recognition.start();
            });

            function stopListening() {
                isListening = false;
                voiceIndicator.className = 'w-2 h-2 rounded-full mr-2';
                voiceText.textContent = 'Voice Input';
                voiceBtn.className = voiceBtn.className.replace('bg-red-500', 'bg-green-600');
            }

            analyzeBtn.addEventListener('click', () => {
                const symptoms = symptomsInput.value.toLowerCase().trim();
                if (!symptoms) {
                    alert('Please enter symptoms first');
                    return;
                }

                // Symptom analysis logic
                const emergencySymptoms = ['chest pain', 'difficulty breathing', 'severe headache', 'unconscious', 'bleeding'];
                const commonSymptoms = ['fever', 'cough', 'cold', 'headache', 'stomach ache'];

                const hasEmergency = emergencySymptoms.some(symptom => symptoms.includes(symptom));
                const hasCommon = commonSymptoms.some(symptom => symptoms.includes(symptom));

                let result = '';
                let severity = '';

                if (hasEmergency) {
                    result = '🚨 URGENT: Seek immediate medical attention or call emergency services';
                    severity = 'severity-high';
                    emergencyCall.classList.remove('hidden');
                } else if (hasCommon) {
                    result = 'Common symptoms detected - Home care recommended. Consult healthcare provider if symptoms persist.';
                    severity = 'severity-medium';
                    emergencyCall.classList.add('hidden');
                } else {
                    result = 'Please provide more specific symptoms for better assessment or consult a healthcare professional.';
                    severity = 'severity-low';
                    emergencyCall.classList.add('hidden');
                }

                resultText.textContent = result;
                resultDiv.className = `p-4 rounded-lg border ${severity}`;
                resultDiv.classList.remove('hidden');
            });
        }

        // Pharmacy Search
        function initPharmacySearch() {
            const medicineInput = document.getElementById('medicine-search');
            const searchBtn = document.getElementById('search-medicine-btn');
            const resultsDiv = document.getElementById('pharmacy-results');

            const pharmacyDB = [
                { name: 'Paracetamol', available: true, pharmacy: 'Village Health Store', distance: '0.5 km', price: '₹15', stock: 50 },
                { name: 'Aspirin', available: true, pharmacy: 'Medical Shop', distance: '1.2 km', price: '₹25', stock: 30 },
                { name: 'Cough Syrup', available: false, pharmacy: 'N/A', distance: 'N/A', price: 'N/A', stock: 0 },
                { name: 'Antacid', available: true, pharmacy: 'Community Pharmacy', distance: '2.1 km', price: '₹40', stock: 25 },
                { name: 'Insulin', available: true, pharmacy: 'District Hospital Pharmacy', distance: '5.0 km', price: '₹120', stock: 15 },
                { name: 'Blood Pressure Medicine', available: true, pharmacy: 'Village Health Store', distance: '0.5 km', price: '₹85', stock: 20 }
            ];

            function searchMedicine() {
                const query = medicineInput.value.trim().toLowerCase();
                if (!query) {
                    alert('Please enter a medicine name');
                    return;
                }

                searchBtn.textContent = 'Searching...';
                searchBtn.disabled = true;

                setTimeout(() => {
                    const results = pharmacyDB.filter(med => 
                        med.name.toLowerCase().includes(query)
                    );

                    if (results.length === 0) {
                        resultsDiv.innerHTML = `<p class="text-gray-600 text-center py-4">No results found for "${query}"</p>`;
                    } else {
                        resultsDiv.innerHTML = `
                            <h3 class="font-semibold text-gray-700 mb-3">Search Results:</h3>
                            ${results.map(item => `
                                <div class="p-4 rounded-lg border ${item.available ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'}">
                                    <div class="flex justify-between items-start">
                                        <div class="flex-1">
                                            <h4 class="font-medium text-gray-800">${item.name}</h4>
                                            <p class="text-sm text-gray-600">
                                                ${item.available ? `Available at ${item.pharmacy}` : 'Currently out of stock'}
                                            </p>
                                            ${item.available ? `
                                                <p class="text-sm text-gray-500">Distance: ${item.distance} • Price: ${item.price}</p>
                                                <p class="text-sm text-gray-500">Stock: ${item.stock} units available</p>
                                            ` : ''}
                                        </div>
                                        <div class="text-right">
                                            <span class="px-2 py-1 rounded-full text-xs ${item.available ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                                ${item.available ? 'Available' : 'Out of Stock'}
                                            </span>
                                            ${item.available && item.stock < 20 ? '<p class="text-xs text-orange-600 mt-1">Low Stock</p>' : ''}
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        `;
                    }

                    searchBtn.textContent = 'Search';
                    searchBtn.disabled = false;
                }, 1000);
            }

            searchBtn.addEventListener('click', searchMedicine);
            medicineInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    searchMedicine();
                }
            });
        }

        // Teleconsultation
        function initTeleconsultation() {
            const consultationSetup = document.getElementById('consultation-setup');
            const consultationActive = document.getElementById('consultation-active');
            const consultationType = document.getElementById('consultation-type');
            const startBtn = document.getElementById('start-consultation-btn');
            const endCallBtn = document.getElementById('end-call-btn');
            const leaveCallBtn = document.getElementById('leave-call-btn');
            const roomIdSpan = document.getElementById('room-id');
            const consultationIcon = document.getElementById('consultation-icon');
            const consultationTypeDisplay = document.getElementById('consultation-type-display');

            const consultationTypes = {
                general: { icon: '👨‍⚕️', label: 'General Consultation' },
                emergency: { icon: '🚨', label: 'Emergency Consultation' },
                followup: { icon: '📋', label: 'Follow-up Consultation' },
                specialist: { icon: '🔬', label: 'Specialist Consultation' }
            };

            consultationType.addEventListener('change', (e) => {
                const selectedType = consultationTypes[e.target.value];
                startBtn.textContent = `Start ${selectedType.label}`;
            });

            startBtn.addEventListener('click', () => {
                const roomId = 'telemedicine-' + Math.random().toString(36).substr(2, 9);
                const selectedType = consultationTypes[consultationType.value];
                
                roomIdSpan.textContent = roomId;
                consultationIcon.textContent = selectedType.icon;
                consultationTypeDisplay.textContent = selectedType.label;
                
                consultationSetup.style.display = 'none';
                consultationActive.classList.remove('hidden');
            });

            function endConsultation() {
                consultationSetup.style.display = 'block';
                consultationActive.classList.add('hidden');
            }

            endCallBtn.addEventListener('click', endConsultation);
            leaveCallBtn.addEventListener('click', endConsultation);
        }

        // Online/Offline Status
        function updateOnlineStatus() {
            const statusEl = document.getElementById('connection-status');
            const statusText = document.getElementById('status-text');
            const offlineIndicator = document.getElementById('offline-indicator');

            if (appState.isOnline) {
                statusEl.className = 'flex items-center px-3 py-1 rounded-full text-sm status-online';
                statusText.textContent = t('online');
                offlineIndicator.classList.add('hidden');
            } else {
                statusEl.className = 'flex items-center px-3 py-1 rounded-full text-sm status-offline';
                statusText.textContent = t('offline');
                offlineIndicator.classList.remove('hidden');
            }
        }

        // Language Change Handler
        function initLanguageSelector() {
            const languageSelector = document.getElementById('language-selector');
            
            languageSelector.addEventListener('change', (e) => {
                appState.currentLanguage = e.target.value;
                updateTranslations();
                updateOnlineStatus();
            });
        }

        // Tab Navigation
        function initTabNavigation() {
            document.querySelectorAll('[data-tab]').forEach(tab => {
                tab.addEventListener('click', (e) => {
                    const tabId = e.currentTarget.getAttribute('data-tab');
                    showTab(tabId);
                });
            });
        }

        // Network Status Listeners
        window.addEventListener('online', () => {
            appState.isOnline = true;
            updateOnlineStatus();
        });

        window.addEventListener('offline', () => {
            appState.isOnline = false;
            updateOnlineStatus();
        });

        // Initialize Application
        function init() {
            initTabNavigation();
            initLanguageSelector();
            initPatientRegistration();
            initHealthRecords();
            initSymptomChecker();
            initPharmacySearch();
            initTeleconsultation();
            updateOnlineStatus();
            updateTranslations();
            
            // Show patients tab by default
            showTab('patients');
        }

        // Start the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>